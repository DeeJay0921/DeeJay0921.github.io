<!DOCTYPE html>
<html>
  <!-- Html Head Tag-->
  <head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content>
  <meta name="author" content="DeeJay">
  <!-- Open Graph Data -->
  <meta property="og:title" content="JS定时器-setTimeout-异步">
  <meta property="og:description" content="web前端 Java后端">
  <meta property="og:site_name" content="DeeJay&#39;s Blog">
  <meta property="og:type" content="article">
  <meta property="og:image" content="https://deejay0921.github.io">
  
    <link rel="alternate" href="/atom.xml" title="DeeJay&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.jpg">
  

  <!-- Site Title -->
  <title>DeeJay's Blog</title>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <!-- Custom CSS -->
  
  <link rel="stylesheet" href="/css/style.light.css">

  <!-- Google Analytics -->
  

</head>

  <body>
    <!-- Page Header -->


<header class="site-header header-background" style="background-image: url(/img/blog-banner2.png)">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="page-title with-background-image">
          <p class="title">JS定时器-setTimeout-异步</p>
          <p class="subtitle"></p>
        </div>
        <div class="site-menu with-background-image">
          <ul>
            
              <li>
                <a href="/">
                  
                  Home
                  
                </a>
              </li>
            
              <li>
                <a href="/archives">
                  
                  Archives
                  
                </a>
              </li>
            
              <li>
                <a href="https://github.com/DeeJay0921">
                  
                  Github
                  
                </a>
              </li>
            
              <li>
                <a href="mailto:1018805743@qq.com">
                  
                  Email
                  
                </a>
              </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>

<article>
  <div class="container typo">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-info text-muted">
          
            <!-- Author -->
            <span class="author info">By DeeJay</span>
          
          <!-- Date -->
          <span class="date-time info">On
            <span class="date">2017-08-19</span>
            <span class="time">01:26:22</span>
          </span>
          
          <!--  Categories  -->
            <span class="categories info">Under 

<a href="/categories/前端/">前端</a>
</span>
          
        </div>
        <!-- Tags -->
        
          <div class="post-tags text-muted">
            Tags: 

<a class="tag" href="/tags/前端/">#前端</a> <a class="tag" href="/tags/JS/">#JS</a> <a class="tag" href="/tags/异步/">#异步</a>


          </div>
        
        <!-- Post Main Content -->
        <div class="post-content">
          <p>JS定时器-setTimeout-异步</p>
<a id="more"></a>

<p><a href="https://zhuanlan.zhihu.com/p/22685960" target="_blank" rel="noopener">异步  参考文章</a></p>
<ul>
<li>函数调用和函数的区别<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// 函数和函数调用的区别</span><br><span class="line"></span><br><span class="line">function fn () &#123; //函数</span><br><span class="line">    return 1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn(); //函数调用</span><br><span class="line">console.log(fn); // ƒ fn() &#123;return 1;&#125;</span><br><span class="line">console.log(fn()); //1</span><br><span class="line"></span><br><span class="line">// 函数返回函数的时候调用当前函数即为return的那个函数</span><br><span class="line">function fn2 () &#123;</span><br><span class="line">    return function () &#123;</span><br><span class="line">        return 2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">fn2//是一个函数</span><br><span class="line">fn2()//也是一个函数 function () &#123; return 2; &#125;</span><br><span class="line">fn2()(); //2</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>###　定时器</p>
<ul>
<li>先看一个例子<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function fn ()&#123;</span><br><span class="line">    console.log(1);</span><br><span class="line">&#125;</span><br><span class="line">setTimeout(fn);</span><br><span class="line">console.log(2);</span><br><span class="line">//上述代码输出 2 1，先输出2后输出1</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>setTimeout设定了一个输出1的事件在0秒后执行，那么浏览器会先将目前的代码都执行完成后再回头执行setTimeout中的代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function fn ()&#123;</span><br><span class="line">    console.log(1);</span><br><span class="line">&#125;</span><br><span class="line">var timeId = setTimeout(fn);</span><br><span class="line">console.log(&apos;id:&apos; + timeId);//1</span><br><span class="line">console.log(2);</span><br><span class="line">timeId = setTimeout(fn);</span><br><span class="line">console.log(&apos;id:&apos; + timeId);//2</span><br><span class="line"></span><br><span class="line">//每次要执行setTimeout的函数的时候，就要销毁这个setTimeout，然后下次在定义个相同的setTimeout的时候，id是不一样的。</span><br></pre></td></tr></table></figure>

<ul>
<li><p>间隔永远要比要比设置的久</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function fn ()&#123;</span><br><span class="line">    console.log(1);</span><br><span class="line">    console.log(new Date()-0);</span><br><span class="line">&#125;</span><br><span class="line">setTimeout(fn);</span><br><span class="line">console.log(new Date()-0);</span><br><span class="line">// 设置了时间延时为0，但是输出的date还是有几十毫秒的差别，这是因为浏览器就算是延时为0，也要先将当前页面执行完，等‘闲下来’的时候再来执行setTimeout</span><br><span class="line">// 所以这样造成的结果是，间隔永远要比要比设置的久</span><br></pre></td></tr></table></figure>
</li>
<li><p>定时器的‘怠惰’问题<br>当浏览器失去焦点的时候，即用户不在关注浏览器的时候，定时器的输出会变慢，比如设置0.5秒执行一次，有可能最小化浏览器之后1秒才执行一次这么做是为了节省内存。</p>
</li>
<li><p>关于setInterval<br>setInteval只有一个timerId,和setTimeout不同</p>
</li>
<li><p>setTimeout的函数的传参</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(fn,500,1,2,3);</span><br><span class="line">function fn () &#123;</span><br><span class="line">    console.log(arguments); //[1,2,3]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>怎么取消定时器 <strong>window.clearTimeout(timerId)</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var timerId = setTimeout(&apos;console.log(&quot;设置了clearTimeout,这条会被阻止执行&quot;)&apos;,3000);</span><br><span class="line">window.clearTimeout(timerId); //阻止前面的setTimeout执行</span><br><span class="line">var timerId2 = setTimeout(&apos;console.log(&quot;没设置clearTimeout,这条会被执行&quot;)&apos;,3000);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="异步-和-回调"><a href="#异步-和-回调" class="headerlink" title="异步 和 回调"></a>异步 和 回调</h3><p>看下面两个例子，异步就是不等结果，去执行别的代码，让一个回调函数来通知我结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function queue () &#123;</span><br><span class="line">    setTimeout(function () &#123;</span><br><span class="line">        return &quot;您的号码是233&quot;;</span><br><span class="line">    &#125;,60000); //60s之后才能拿到结果</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var result = queue();</span><br><span class="line">console.log(result); //undefined 因为queue这个函数没有写return，所以默认返回undefined  拿不到想要的匿名函数的返回值</span><br></pre></td></tr></table></figure>

<p>这时候想要拿到匿名函数的返回值,可以创建一个对象或者函数,传入queue中，queue中的匿名函数不用设置return，因为设置了也拿不到 然后不设置return，直接让这个创建的代理函数获取到值，就可以输出.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">    function queue (agent) &#123;　 //传入agent给形参</span><br><span class="line">        setTimeout(function () &#123;</span><br><span class="line">            agent(&quot;您的号码是233&quot;); // 匿名函数里不写return，写了也拿不到，直接用agent函数获取这个值</span><br><span class="line">        &#125;,3000); //60s之后才能拿到结果</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">//    这时候想要拿到匿名函数的返回值,可以创建一个对象或者函数,传入queue中，queue中的匿名函数不用设置return，因为设置了也拿不到</span><br><span class="line">//    然后不设置return，直接让这个创建的代理函数获取到值，就可以输出</span><br><span class="line">    function agent (result) &#123; //创建一个函数</span><br><span class="line">        console.log(result);</span><br><span class="line">    &#125;</span><br><span class="line">    queue(agent); //将创建的函数传入queue</span><br></pre></td></tr></table></figure>

<p>整体思路是，程序还要接着执行下面的，创建一个代理函数去得到值，等setTimeout的时间间隔到了之后拿到值之后返回给程序。</p>
<p>在上述例子中，<strong>agent函数就是一个回调函数</strong>。由全局传递给queue，然后queue调用之后又传回给全局。叫做回调函数。 <strong>“我传给你，你调用再传回给我”</strong></p>
<p><strong>异步和回调往往是同时出现的。</strong>因为异步了之后不回调，就相当于不要这个返回结果了。</p>
<h3 id="相关的一些问题分析"><a href="#相关的一些问题分析" class="headerlink" title="相关的一些问题分析"></a>相关的一些问题分析</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for (var i = 0; i &lt; 5; i ++) &#123;</span><br><span class="line">    console.log(i); //0 1 2 3 4</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">for (var i = 0; i &lt; 5; i ++) &#123;</span><br><span class="line">    setTimeout(function () &#123;  //for循环线结束，才运行setTimeout  这时候i的值都是5</span><br><span class="line">        console.log(i);</span><br><span class="line">    &#125;,1000*i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第一次马上输出5  第二次是1000毫秒之后输出5 第三次是2000毫秒之后输出5 以此类推到第五次,j即每一秒打印一个<br><strong>setTimeout内部匿名函数要输出i时，找不到i，要到上一级也就是全局中找i，这时候i已经为5了</strong>，而外部的时间间隔i跟全局的i是同一个东西，每次的值为0,1,2,3,4</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">for (var i = 0; i &lt; 5; i ++) &#123;</span><br><span class="line">    (function () &#123;</span><br><span class="line">        setTimeout(function () &#123;</span><br><span class="line">            console.log(i);</span><br><span class="line">        &#125;,i * 1000);</span><br><span class="line">    &#125;)(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>和第二题的结果一样，1000乘i的那个i是是全局中的i，每次为0,1,2,3,4</p>
<p>而setTimeout里面的函数的作用域中要输出的i不存在，要<strong>到上一级中作用域即立即执行函数中找i，立即执行函数中也没有i</strong>，再到全局作用域中找i，这时候for循环已经结束了，i为5，所以每次输出5,</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">for (var i = 0; i &lt; 5; i ++) &#123;</span><br><span class="line">    (function (i) &#123;</span><br><span class="line">        setTimeout(function () &#123;</span><br><span class="line">            console.log(i);</span><br><span class="line">        &#125;,i * 1000);</span><br><span class="line">    &#125;)(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>和第3题不同，这里立即执行函数写了一个形参，这个形参相当于一个变量声明var i = arguments[0];</p>
<p>那么setTimeout里面的函数在输出i时，找不到i，到上一级作用域即立即执行函数中去找，和第3题不同的是<strong>这次立即执行函数里面有i了</strong>，<strong>不会再到全局作用域里找i了</strong>。</p>
<p>写了形参就相当于定义了i，所以这时候输出的i是立即执行函数中的i，这个i传入的值就是当时的全局中i的值0,1,2,3,4</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">for (var i = 0; i &lt; 5; i ++) &#123;</span><br><span class="line">    setTimeout((function (i) &#123;</span><br><span class="line">        console.log(i);</span><br><span class="line">    &#125;)(i),i * 1000)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第5题仍然通过作用域链进行理解，setTimeout里面的函数的作用域中<strong>要输出的i，就是立即执行函数中的i</strong>，因为定义了形参，这个形参每次接收的i是<strong>当时全局中的i的值为0,1,2,3,4</strong>. 而时间间隔的i就是全局中的i，每次的值为0,1,2,3,4。<br>求得结果之后，针对第5题，我们可以简化一下代码，仔细分析一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">for (var i = 0; i &lt; 5; i ++) &#123;</span><br><span class="line">    var t1 = function (i) &#123;</span><br><span class="line">        console.log(i);</span><br><span class="line">    &#125;;</span><br><span class="line">    var t2 = t1(i);</span><br><span class="line">    setTimeout(t2,1000*i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那么把代码拆开之后我们再来分析，此时setTimeout里面执行的是t2，t2是t1调用的结果，t1里面没有写return，那么默认返回undefined，所以t2为undefined，此时其实就相当于：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(undefined,0);</span><br><span class="line">setTimeout(undefined,1000);</span><br><span class="line">setTimeout(undefined,2000);</span><br><span class="line">setTimeout(undefined,3000);</span><br><span class="line">setTimeout(undefined,4000);</span><br></pre></td></tr></table></figure>

<p>而输出的值是t1中的console.log(i);我们也可以很清晰的看到，这个i就是传入的当时的每次的i值0,1,2,3,4</p>
<h3 id="setTimeout的应用：做个倒计时器"><a href="#setTimeout的应用：做个倒计时器" class="headerlink" title="setTimeout的应用：做个倒计时器"></a>setTimeout的应用：做个倒计时器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot;</span><br><span class="line">          content=&quot;width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;select placeholder=&quot;选择一个时间&quot; name=&quot;&quot; id=&quot;mySelect&quot;&gt;</span><br><span class="line">    &lt;option value=&quot;1&quot; selected&gt;1分钟&lt;/option&gt;</span><br><span class="line">    &lt;option value=&quot;5&quot;&gt;5分钟&lt;/option&gt;</span><br><span class="line">    &lt;option value=&quot;10&quot;&gt;10分钟&lt;/option&gt;</span><br><span class="line">    &lt;option value=&quot;20&quot;&gt;20分钟&lt;/option&gt;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line">&lt;button id=&quot;start&quot;&gt;开始计时&lt;/button&gt;</span><br><span class="line">&lt;button id=&quot;pause&quot; disabled&gt;暂停计时&lt;/button&gt;</span><br><span class="line">&lt;button id=&quot;resume&quot; disabled&gt;恢复计时&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">&lt;div id=&quot;show&quot;&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">    var show = document.querySelector(&apos;#show&apos;);</span><br><span class="line">    var start = document.querySelector(&apos;#start&apos;);</span><br><span class="line">    var pause = document.querySelector(&apos;#pause&apos;);</span><br><span class="line">    var resume = document.querySelector(&apos;#resume&apos;);</span><br><span class="line">    var select = document.querySelector(&apos;#mySelect&apos;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//    var timeLeft;</span><br><span class="line">//    function showtime () &#123;</span><br><span class="line">//        show.innerText = timeLeft + &apos;秒&apos;;</span><br><span class="line">//        timeLeft -= 1;</span><br><span class="line">//        if (timeLeft === 0) &#123;</span><br><span class="line">//            return;</span><br><span class="line">//        &#125;</span><br><span class="line">//        setTimeout(showtime,1000);</span><br><span class="line">//    &#125;</span><br><span class="line">//    start.addEventListener(&apos;click&apos;,function () &#123;</span><br><span class="line">//        var seconds = 60 * parseInt(select.value);</span><br><span class="line">//        timeLeft = seconds;</span><br><span class="line">//        showtime();</span><br><span class="line">//    &#125;);</span><br><span class="line">// 上面的代码能实现效果但是存在bug，连续点击start倒计时会越来越快，有多个setTimeout在控制计时</span><br><span class="line">// 所以要解决这个问题，在再一次点击start的时候，要将上一次的setTimeout清除掉,怎么得到上一次的setTimeout呢，可以通过设置timerId</span><br><span class="line"></span><br><span class="line">    var timeLeft;</span><br><span class="line">    var lastTimerId; // 全局中定义个lastTinmerId</span><br><span class="line">    function showtime () &#123;</span><br><span class="line">        show.innerText = timeLeft + &apos;秒&apos;;</span><br><span class="line">        timeLeft -= 1;</span><br><span class="line">        if (timeLeft === 0) &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        lastTimerId = setTimeout(showtime,1000); //执行seTimeout时顺便给timerId赋值</span><br><span class="line">    &#125;</span><br><span class="line">    start.addEventListener(&apos;click&apos;,function () &#123;</span><br><span class="line">        var seconds = 60 * parseInt(select.value);</span><br><span class="line">        timeLeft = seconds;</span><br><span class="line">//        执行函数前先清除上一次的setTimeout</span><br><span class="line">        if (lastTimerId !== undefined) &#123;</span><br><span class="line">            window.clearTimeout(lastTimerId);</span><br><span class="line">        &#125;</span><br><span class="line">        showtime();</span><br><span class="line">        pause.disabled = false; //点了start才能点击pause</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">//    接下来设置暂停和恢复</span><br><span class="line">//    暂停的思路很简单,恢复的思路就是不要重新赋值timeLeft,保持暂停的时候的timeLeft就可以</span><br><span class="line">    pause.addEventListener(&apos;click&apos;,function () &#123;</span><br><span class="line">        if (lastTimerId) &#123;</span><br><span class="line">            window.clearTimeout(lastTimerId);</span><br><span class="line">        &#125;</span><br><span class="line">        resume.disabled = false; //点了pause才能点resume</span><br><span class="line">        pause.disabled = true; //点了pause之后不能再点击pause</span><br><span class="line">    &#125;)</span><br><span class="line">    resume.addEventListener(&apos;click&apos;,function () &#123;</span><br><span class="line">        showtime(); //就一行代码， showTime()就是把当前的timeLeft打出来，并没有给timeLeft重新赋值</span><br><span class="line">        pause.disabled = false; //点了resume之后就可以点pause</span><br><span class="line">        resume.disabled = true; //点了resume之后，不可以继续点击resume</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>


        </div>
      </div>
    </div>
  </div>
</article>



    <!-- Footer -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <p class="copyright text-muted">
          Theme By <a target="_blank" href="https://github.com/levblanc">Levblanc.</a>
          Inspired By <a target="_blank" href="https://github.com/klugjo/hexo-theme-clean-blog">Clean Blog.</a>
        <p class="copyright text-muted">
          Powered By <a target="_blank" href="https://hexo.io/">Hexo.</a>
        </p>
      </div>
    </div>
  </div>
</footer>


    <!-- After Footer Scripts -->
<script src="/js/highlight.pack.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function(event) {
    var codeBlocks = Array.prototype.slice.call(document.getElementsByTagName('pre'))
    codeBlocks.forEach(function(block, index) {
      hljs.highlightBlock(block);
    });
  });
</script>

  </body>
</html>

