<!DOCTYPE html>
<html>
  <!-- Html Head Tag-->
  <head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content>
  <meta name="author" content="DeeJay">
  <!-- Open Graph Data -->
  <meta property="og:title" content="ajax实践">
  <meta property="og:description" content="web前端 Java后端">
  <meta property="og:site_name" content="DeeJay&#39;s Blog">
  <meta property="og:type" content="article">
  <meta property="og:image" content="https://deejay0921.github.io">
  
    <link rel="alternate" href="/atom.xml" title="DeeJay&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.jpg">
  

  <!-- Site Title -->
  <title>DeeJay's Blog</title>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <!-- Custom CSS -->
  
  <link rel="stylesheet" href="/css/style.light.css">

  <!-- Google Analytics -->
  

</head>

  <body>
    <!-- Page Header -->


<header class="site-header header-background" style="background-image: url(/img/blog-banner2.png)">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="page-title with-background-image">
          <p class="title">ajax实践</p>
          <p class="subtitle"></p>
        </div>
        <div class="site-menu with-background-image">
          <ul>
            
              <li>
                <a href="/">
                  
                  Home
                  
                </a>
              </li>
            
              <li>
                <a href="/archives">
                  
                  Archives
                  
                </a>
              </li>
            
              <li>
                <a href="https://github.com/DeeJay0921">
                  
                  Github
                  
                </a>
              </li>
            
              <li>
                <a href="mailto:1018805743@qq.com">
                  
                  Email
                  
                </a>
              </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>

<article>
  <div class="container typo">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-info text-muted">
          
            <!-- Author -->
            <span class="author info">By DeeJay</span>
          
          <!-- Date -->
          <span class="date-time info">On
            <span class="date">2017-08-22</span>
            <span class="time">18:00:32</span>
          </span>
          
          <!--  Categories  -->
            <span class="categories info">Under 

<a href="/categories/前端/">前端</a>
</span>
          
        </div>
        <!-- Tags -->
        
          <div class="post-tags text-muted">
            Tags: 

<a class="tag" href="/tags/前端/">#前端</a> <a class="tag" href="/tags/Ajax/">#Ajax</a>


          </div>
        
        <!-- Post Main Content -->
        <div class="post-content">
          <p>ajax实践</p>
<a id="more"></a>

<p>##1， ajax 是什么？有什么作用？<br>ajax（Asynchronous JavaScript and XML）以异步的方式从服务器获取数据，不必刷新页面也能获取新数据。ajax的核心对象就是XMLhttpRequest，通过JavaScript DOM将ajax获得的数据显示在页面上。</p>
<p>作用是带来更好的用户体验。</p>
<p>##2， 前后端开发联调需要注意哪些事情？后端接口完成前如何 mock 数据？<br>前后端开发时需要注意：</p>
<ol>
<li>约定接口类型（GET还是POST)、接口（传递到那个路由）</li>
<li>前端传递给后端的参数（参数的类型、格式）</li>
<li>后端返回数据的格式（是数组还是字符串还是JSON格式）</li>
</ol>
<p>后端接口完成前可以使用server-mock搭建模拟服务器</p>
<p>##3，点击按钮，使用 ajax 获取数据，如何在数据到来之前防止重复点击?</p>
<p>设置判断变量，数据没拿到时设置为false，拿到数据才设置为true，为false时忽略后面的点击事件</p>
<p>本例中的isDataArrive即为判断数据是否拿到的变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    //整体思路就是给按钮添加点击事件，写ajax得到数据，然后通过渲染添加到html上就可以了</span><br><span class="line">    var btn = document.querySelector(&apos;#load-more&apos;);</span><br><span class="line">    var ct = document.querySelector(&apos;#ct&apos;);</span><br><span class="line">    var tempIndex = 3;//记录每次的变量</span><br><span class="line"></span><br><span class="line">//    针对网速较慢并且重复点击的情况做得优化：第一种思路，如果一点时间内请求没到，忽略用户后面点击的。第二种思路，用户点击了多次，每次的输出内容都要显示</span><br><span class="line">    var isDataArrive = true; // 设置判断变量，数据没拿到时设置为false</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    btn.addEventListener(&apos;click&apos;,function () &#123;</span><br><span class="line"></span><br><span class="line">        if (!isDataArrive) &#123;</span><br><span class="line">            return; //如果数据没拿到，直接return掉，后面的点击就被忽略掉</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        var xhr = new XMLHttpRequest();</span><br><span class="line">        xhr.onreadystatechange = function () &#123;</span><br><span class="line">            if (xhr.readyState === 4 &amp;&amp;　(xhr.status == 200 || xhr.status == 304)) &#123;</span><br><span class="line">                var content = JSON.parse(xhr.responseText);</span><br><span class="line">//                console.log(content); //写到这先测试一下给的数据对不对</span><br><span class="line">//                开始拼装html</span><br><span class="line">//                var html = &apos;&apos;;</span><br><span class="line">//                for (var i = 0; i &lt; content.length; i ++) &#123;</span><br><span class="line">//                    html += &apos;&lt;li&gt;&apos; + content[i] + &apos;&lt;/li&gt;&apos;;</span><br><span class="line">//                &#125;</span><br><span class="line">//               拼装好html，应该是appendChild到ct后面，但是每次appendChild回影响性能，可以使用Fragment，所以可以改写为：</span><br><span class="line">                var fragment = document.createDocumentFragment();</span><br><span class="line">                for (var i = 0; i &lt; content.length; i ++) &#123;</span><br><span class="line">                    var node = document.createElement(&apos;li&apos;);</span><br><span class="line">                    node.innerText = content[i]; // 使用innerText不用innerHTML还有个好处是可以防止xss注入</span><br><span class="line">                    fragment.appendChild(node);</span><br><span class="line">                &#125;</span><br><span class="line">                ct.appendChild(fragment);</span><br><span class="line">                tempIndex += 5;</span><br><span class="line"></span><br><span class="line">                isDataArrive = true;//readyState === 4 表示数据已经拿到了</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        xhr.open(&apos;get&apos;,&apos;/loadMore?index=&apos;+ tempIndex +&apos;&amp;length=5&apos;,true);</span><br><span class="line">//       前端需要得到一个数组 [&apos;content1&apos;,&apos;content2&apos;,...,&apos;content5&apos;]</span><br><span class="line">//       前端需要向后端发送的  /loadMore?index=3&amp;length=5                  /loadMore为接口，后端对loadMore进行处理</span><br><span class="line">//        &#123;</span><br><span class="line">//            index: 3,</span><br><span class="line">//            length: 5,</span><br><span class="line">//         &#125;</span><br><span class="line">/*          一般在请求数据之前都要想清楚前端需要得到什么数据，需要向后端发送的是什么接口，参数是怎么样的。</span><br><span class="line">            1.GET</span><br><span class="line">            2./loadMore</span><br><span class="line">            3. &#123;</span><br><span class="line">                index: 3,</span><br><span class="line">                length: 5,</span><br><span class="line">            &#125;</span><br><span class="line">            4. [&apos;content1&apos;,&apos;content2&apos;,...,&apos;content5&apos;]</span><br><span class="line"> */</span><br><span class="line">        xhr.send();</span><br><span class="line">        isDataArrive = false; // 没拿到数据设置为false</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>


        </div>
      </div>
    </div>
  </div>
</article>



    <!-- Footer -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <p class="copyright text-muted">
          Theme By <a target="_blank" href="https://github.com/levblanc">Levblanc.</a>
          Inspired By <a target="_blank" href="https://github.com/klugjo/hexo-theme-clean-blog">Clean Blog.</a>
        <p class="copyright text-muted">
          Powered By <a target="_blank" href="https://hexo.io/">Hexo.</a>
        </p>
      </div>
    </div>
  </div>
</footer>


    <!-- After Footer Scripts -->
<script src="/js/highlight.pack.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function(event) {
    var codeBlocks = Array.prototype.slice.call(document.getElementsByTagName('pre'))
    codeBlocks.forEach(function(block, index) {
      hljs.highlightBlock(block);
    });
  });
</script>

  </body>
</html>

